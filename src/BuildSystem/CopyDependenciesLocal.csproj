<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <OutputPath>..\..\bin\Release\</OutputPath>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <OutputPath>..\..\bin\Debug\</OutputPath>
  </PropertyGroup>
  <PropertyGroup>
	<OutputPath32>$(OutputPath)\32BitComponents</OutputPath32>
  </PropertyGroup>
  <PropertyGroup>
    <ProjectGuid>{8B599BFF-B414-41A3-A270-96CDA0C522AF}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>CopyDependenciesLocal</RootNamespace>
    <AssemblyName>CopyDependenciesLocal</AssemblyName>
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
  </PropertyGroup>
  <PropertyGroup>
    <LocalBlueSolution>..\..\..\Level0\src\Blue.sln</LocalBlueSolution>
    <LocalStartAllScript>..\BuildSystem\Scripts\start_all.bat</LocalStartAllScript>
    <LocalKillAllScript>..\BuildSystem\Scripts\kill_all.bat</LocalKillAllScript>
    <LocalGatewayXML>..\scnetworkgateway\scripts\scnetworkgateway.xml</LocalGatewayXML>
    <ScerrresDll>
        ..\Starcounter.ErrorCodes\scerrres\x64\$(Configuration)\scerrres.dll;
        ..\Starcounter.ErrorCodes\scerrres\x64\$(Configuration)\scerrres.pdb;
        ..\Starcounter.ErrorCodes\scerrres\x64\$(Configuration)\scerrres.lib
    </ScerrresDll>
	<ScerrresDll32>
        ..\Starcounter.ErrorCodes\scerrres\Win32\$(Configuration)\scerrres.dll;
        ..\Starcounter.ErrorCodes\scerrres\Win32\$(Configuration)\scerrres.pdb;
        ..\Starcounter.ErrorCodes\scerrres\Win32\$(Configuration)\scerrres.lib
    </ScerrresDll32>
  </PropertyGroup>
  <PropertyGroup>
    <LocalBlueBinariesDir>..\..\..\Level0\src\x64\$(Configuration)</LocalBlueBinariesDir>
  </PropertyGroup>
  <ItemGroup>
    <LocalGatewayTestFiles Include="..\scnetworkgateway\scripts\gw_test_*" />
  </ItemGroup>
  <ItemGroup>
    <LocalTestRunScripts Include="..\Samples\LoadAndLatency\run_loadandlatency_test.bat;..\Samples\SqlCacheTrasher\run_sqlcachetrasher_test.bat" />
  </ItemGroup>
  <Target Name="CopyLocalFiles">
    <!-- Building Blue solution if any. -->
    <Exec Condition="'$(BUILD_BLUE_FROM_LEVEL1)' == 'True' AND Exists('$(LocalBlueSolution)')" Command="C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe $(LocalBlueSolution) /property:Configuration=$(Configuration);Platform=x64;GenerateFullPaths=true /consoleloggerparameters:Summary /verbosity:minimal /maxcpucount" />
    <!-- Creating dynamic copied files lists. -->
    <ItemGroup>
      <LocalBlueBinFiles Include="$(LocalBlueBinariesDir)\*" />
    </ItemGroup>
    <!-- Local files. -->
    <Copy Condition="Exists('$(LocalBlueSolution)')" SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="@(LocalBlueBinFiles)" DestinationFiles="@(LocalBlueBinFiles->'$(OutputPath)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="$(LocalStartAllScript)" DestinationFolder="$(OutputPath)" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="$(LocalKillAllScript)" DestinationFolder="$(OutputPath)" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="@(LocalTestRunScripts)" DestinationFolder="$(OutputPath)" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="$(LocalGatewayXML)" DestinationFolder="$(OutputPath)" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="@(LocalGatewayTestFiles)" DestinationFolder="$(OutputPath)" />
    <Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="$(ScerrresDll)" DestinationFolder="$(OutputPath)" />
	<Copy SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" SourceFiles="$(ScerrresDll32)" DestinationFolder="$(OutputPath32)" />
  </Target>
  <Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />
  <Target Name="Build" DependsOnTargets="CopyLocalFiles" />
</Project>