// Generated code. This code serializes and deserializes Typed Json. The code was generated by Starcounter.

using System;
using System.Runtime.InteropServices;
using Starcounter;
using Starcounter.Internal;
using Starcounter.Internal.Application.CodeGeneration;
using Starcounter.Templates;
using Starcounter.XSON.Serializers;

namespace __starcountergenerated__ {
    public class PreGeneratedSerializer : TypedJsonSerializerBase {
#pragma warning disable 0219
#pragma warning disable 0168

#pragma warning disable 0414
        private static int VerificationOffset0 = 0; // PlayerId
        private static int VerificationOffset1 = 8; // Accounts
#pragma warning restore 0414
        private static byte[] VerificationBytes = new byte[] { (byte)'P', (byte)'l', (byte)'a', (byte)'y', (byte)'e', (byte)'r', (byte)'I', (byte)'d', (byte)'A', (byte)'c', (byte)'c', (byte)'o', (byte)'u', (byte)'n', (byte)'t', (byte)'s' };
        private static IntPtr PointerVerificationBytes;

        static PreGeneratedSerializer() {
            PointerVerificationBytes = Marshal.AllocHGlobal(VerificationBytes.Length); // TODO. Free when program exists
            Marshal.Copy(VerificationBytes, 0, PointerVerificationBytes, VerificationBytes.Length);
        }
        public override int PopulateFromJson(Obj realObj, IntPtr buffer, int bufferSize) {
            int valueSize;
            dynamic obj = realObj;
            unsafe {
                byte* pBuffer = (byte*)buffer;
                byte* tmpBuffer = pBuffer;
                byte* pver = null;
                int leftBufferSize = bufferSize;
                int tmpLeftSize = leftBufferSize;
                while (*pBuffer != '{') {
                    if (*pBuffer == '\n' || *pBuffer == '\r' || *pBuffer == '\t' || *pBuffer == ' ') {
                        leftBufferSize--;
                        if (leftBufferSize < 0)
                            JsonHelper.ThrowInvalidJsonException("Beginning of object not found ('{').");
                        pBuffer++;
                    } else
                        JsonHelper.ThrowInvalidJsonException("Unexpected character found, expected '{' but found '" + (char)*pBuffer + "'.");
                }
                while (leftBufferSize > 0) {
                    // Skip until start of next property or end of current object.
                    while (true) {
                        if (*pBuffer == '}') {
                            pBuffer++;
                            leftBufferSize--;
                            return (bufferSize - leftBufferSize);
                        }
                        if (*pBuffer == ',' || *pBuffer == ' ' || *pBuffer == '\n'
                            || *pBuffer == '\r' || *pBuffer == '\t' || *pBuffer == '{') {
                            leftBufferSize--;
                            if (leftBufferSize < 0)
                                JsonHelper.ThrowUnexpectedEndOfContentException();
                            pBuffer++;
                            continue;
                        }
                        if (*pBuffer == '"') {
                            leftBufferSize--;
                            if (leftBufferSize < 0)
                                JsonHelper.ThrowUnexpectedEndOfContentException();
                            pBuffer++;
                        }
                        break;
                    }
                    switch (*pBuffer) {
                        case (byte)'A':
                            tmpBuffer = pBuffer;
                            tmpLeftSize = leftBufferSize;
                            pBuffer++;
                            leftBufferSize--;
                            pver = ((byte*)PointerVerificationBytes + VerificationOffset1 + 1);
                            leftBufferSize -= 4;
                            if (leftBufferSize < 0 || (*(UInt32*)pBuffer) != (*(UInt32*)pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer += 4;
                            pver += 4;
                            leftBufferSize -= 2;
                            if (leftBufferSize < 0 || (*(UInt16*)pBuffer) != (*(UInt16*)pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer += 2;
                            pver += 2;
                            leftBufferSize--;
                            if (leftBufferSize < 0 || (*pBuffer) != (*pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer++;
                            pver++;
                            // Skip until start of value to parse.
                            while (*pBuffer != ':') {
                                leftBufferSize--;
                                if (leftBufferSize < 0)
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                pBuffer++;
                            }
                            pBuffer++; // Skip ':' or ','
                            leftBufferSize--;
                            if (leftBufferSize < 0)
                                JsonHelper.ThrowUnexpectedEndOfContentException();
                            while (*pBuffer == ' ' || *pBuffer == '\n' || *pBuffer == '\r') {
                                leftBufferSize--;
                                if (leftBufferSize < 0)
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                pBuffer++;
                            }
                            if (*pBuffer != '[')
                                JsonHelper.ThrowWrongValueTypeException(null, "Accounts", "Arr`1", "");
                            while (leftBufferSize > 0) {
                                while (*pBuffer != '{' && *pBuffer != ']') { // find first object or end of array
                                    leftBufferSize--;
                                    if (leftBufferSize < 0)
                                        JsonHelper.ThrowUnexpectedEndOfContentException();
                                    pBuffer++;
                                }
                                if (*pBuffer == ']')
                                    break;
                                var val1 = obj.Accounts.Add();
                                valueSize = val1.PopulateFromJson((IntPtr)pBuffer, leftBufferSize);
                                if (valueSize != -1) {
                                    leftBufferSize -= valueSize;
                                    if (leftBufferSize < 0) {
                                        JsonHelper.ThrowUnexpectedEndOfContentException();
                                    }
                                    pBuffer += valueSize;
                                } else {
                                    JsonHelper.ThrowWrongValueTypeException(null, "Accounts", "Arr`1", "");
                                }
                            }
                            if (*pBuffer == ']') {
                                leftBufferSize--;
                                if (leftBufferSize < 0)
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                pBuffer++;
                            }
                            break;
                        case (byte)'P':
                            tmpBuffer = pBuffer;
                            tmpLeftSize = leftBufferSize;
                            pBuffer++;
                            leftBufferSize--;
                            pver = ((byte*)PointerVerificationBytes + VerificationOffset0 + 1);
                            leftBufferSize -= 4;
                            if (leftBufferSize < 0 || (*(UInt32*)pBuffer) != (*(UInt32*)pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer += 4;
                            pver += 4;
                            leftBufferSize -= 2;
                            if (leftBufferSize < 0 || (*(UInt16*)pBuffer) != (*(UInt16*)pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer += 2;
                            pver += 2;
                            leftBufferSize--;
                            if (leftBufferSize < 0 || (*pBuffer) != (*pver))
                                JsonHelper.ThrowPropertyNotFoundException((IntPtr)tmpBuffer, tmpLeftSize);
                            pBuffer++;
                            pver++;
                            // Skip until start of value to parse.
                            while (*pBuffer != ':') {
                                leftBufferSize--;
                                if (leftBufferSize < 0)
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                pBuffer++;
                            }
                            pBuffer++; // Skip ':' or ','
                            leftBufferSize--;
                            if (leftBufferSize < 0)
                                JsonHelper.ThrowUnexpectedEndOfContentException();
                            while (*pBuffer == ' ' || *pBuffer == '\n' || *pBuffer == '\r') {
                                leftBufferSize--;
                                if (leftBufferSize < 0)
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                pBuffer++;
                            }
                            Int64 val0;
                            if (JsonHelper.ParseInt((IntPtr)pBuffer, leftBufferSize, out val0, out valueSize)) {
                                obj.PlayerId = val0;
                                leftBufferSize -= valueSize;
                                if (leftBufferSize < 0) {
                                    JsonHelper.ThrowUnexpectedEndOfContentException();
                                }
                                pBuffer += valueSize;
                            } else {
                                JsonHelper.ThrowWrongValueTypeException(null, "PlayerId", "Int64", "");
                            }
                            break;
                        default:
                            JsonHelper.ThrowPropertyNotFoundException((IntPtr)pBuffer, leftBufferSize);
                            break;
                    }
                }
                throw ErrorCode.ToException(Starcounter.Internal.Error.SCERRUNSPECIFIED, "char: '" + (char)*pBuffer + "', offset: " + (bufferSize - leftBufferSize) + "");
            }
        }
#pragma warning restore 0168
#pragma warning restore 0219
    }
}


